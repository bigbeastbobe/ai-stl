<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI STL Generator - Free 3D Model Creator with Web Search</title>
    <meta name="description" content="Generate 3D printable STL files from text descriptions using AI with web search for better accuracy. Free online tool for creating custom 3D models.">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState } = React;
        
        // Lucide React icons as simple SVG components
        const Box = ({ className }) => (
            <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                <line x1="12" y1="22.08" x2="12" y2="12"/>
            </svg>
        );
        
        const Sparkles = ({ className }) => (
            <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/>
                <path d="M5 3v4"/>
                <path d="M19 17v4"/>
                <path d="M3 5h4"/>
                <path d="M17 19h4"/>
            </svg>
        );
        
        const Download = ({ className }) => (
            <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7 10 12 15 17 10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
        );
        
        const Loader2 = ({ className }) => (
            <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 12a9 9 0 1 1-6.219-8.56"/>
            </svg>
        );
        
        const Globe = ({ className }) => (
            <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="10"/>
                <line x1="2" y1="12" x2="22" y2="12"/>
                <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
            </svg>
        );

        function STLGenerator() {
            const [prompt, setPrompt] = useState('');
            const [loading, setLoading] = useState(false);
            const [stlData, setStlData] = useState(null);
            const [error, setError] = useState('');
            const [modelInfo, setModelInfo] = useState('');
            const [complexity, setComplexity] = useState('medium');
            const [useWebSearch, setUseWebSearch] = useState(true);
            const [searchStatus, setSearchStatus] = useState('');

            const generateSTL = async () => {
                if (!prompt.trim()) {
                    setError('Please enter a prompt');
                    return;
                }

                setLoading(true);
                setError('');
                setStlData(null);
                setModelInfo('');
                setSearchStatus('');

                try {
                    if (useWebSearch) {
                        setSearchStatus('üîç Searching web for reference information...');
                    }

                    const tools = useWebSearch ? [{
                        type: "web_search_20250305",
                        name: "web_search"
                    }] : [];

                    const response = await fetch('https://api.anthropic.com/v1/messages', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            model: 'claude-sonnet-4-20250514',
                            max_tokens: 16000,
                            tools: tools,
                            messages: [
                                {
                                    role: 'user',
                                    content: `You are an expert 3D modeling engineer specializing in generating printable STL files. ${useWebSearch ? 'First, search the web for reference information about the object to understand its real-world dimensions, proportions, and key features. Then use that information to create an accurate model.' : ''}

Your task is to create a detailed, high-quality 3D model from this description:

"${prompt}"

COMPLEXITY LEVEL: ${complexity}
- low: 50-200 triangles (very simple shapes)
- medium: 200-1000 triangles (moderate detail)
- high: 1000-5000 triangles (high detail, smooth curves)

CRITICAL REQUIREMENTS:
1. **Manifold Geometry**: Model MUST be watertight with no holes, gaps, or non-manifold edges
2. **Correct Normals**: All normals must point outward consistently
3. **Proper Scale**: Use millimeters. ${useWebSearch ? 'Use real-world dimensions from your search results.' : 'Typical object size 20-100mm'}
4. **Printability**: Minimum wall thickness 1mm, no floating parts, stable base
5. **Smooth Curves**: Use enough triangles to make curves look smooth (not faceted)

ADVANCED MODELING TECHNIQUES:
- For organic shapes: Use subdivision and smooth interpolation
- For mechanical parts: Include fillets, chamfers, precise dimensions
- For complex objects: Break into components and combine
- Use proper geometric primitives (spheres, cylinders, tori) with sufficient tessellation
- Add supporting structures where needed for overhangs
${useWebSearch ? '- Use proportions and details from your web search results for accuracy' : ''}

Think step-by-step:
1. ${useWebSearch ? 'Search for reference information about the object' : 'Analyze the object description'}
2. Analyze the object's geometry and key features
3. Determine the best modeling approach (primitives, extrusion, revolution, etc.)
4. Calculate vertices for smooth surfaces with accurate proportions
5. Ensure all triangles follow right-hand rule for normals
6. Verify the model is manifold and printable

Return ONLY a JSON object (no markdown, no explanation):
{
  "triangles": [
    {
      "normal": [nx, ny, nz],
      "vertices": [[x1,y1,z1], [x2,y2,z2], [x3,y3,z3]]
    }
  ],
  "description": "Detailed description including dimensions, features, and triangle count${useWebSearch ? ', mentioning if web search was used for accuracy' : ''}",
  "printability_notes": "Any important notes about printing this model"
}`
                                }
                            ]
                        })
                    });

                    const data = await response.json();
                    
                    if (useWebSearch) {
                        setSearchStatus('‚úì Web search complete, generating model...');
                    }
                    
                    // Handle tool use and text responses
                    let content = '';
                    for (const block of data.content) {
                        if (block.type === 'text') {
                            content += block.text;
                        }
                    }
                    
                    // Extract JSON from response
                    let jsonStr = content.trim();
                    if (jsonStr.startsWith('```json')) {
                        jsonStr = jsonStr.replace(/```json\n?/g, '').replace(/```\n?$/g, '');
                    } else if (jsonStr.startsWith('```')) {
                        jsonStr = jsonStr.replace(/```\n?/g, '');
                    }
                    
                    const modelData = JSON.parse(jsonStr);
                    
                    if (!modelData.triangles || !Array.isArray(modelData.triangles)) {
                        throw new Error('Invalid model data structure');
                    }

                    if (modelData.triangles.length === 0) {
                        throw new Error('No triangles generated');
                    }

                    // Create binary STL
                    const triangleCount = modelData.triangles.length;
                    const bufferSize = 80 + 4 + (triangleCount * 50);
                    const buffer = new ArrayBuffer(bufferSize);
                    const view = new DataView(buffer);
                    
                    // Header (80 bytes)
                    const header = `AI Generated: ${prompt.substring(0, 60)}`;
                    for (let i = 0; i < 80; i++) {
                        view.setUint8(i, i < header.length ? header.charCodeAt(i) : 0);
                    }
                    
                    // Triangle count
                    view.setUint32(80, triangleCount, true);
                    
                    // Triangles
                    let offset = 84;
                    for (const tri of modelData.triangles) {
                        // Normal
                        view.setFloat32(offset, tri.normal[0], true);
                        view.setFloat32(offset + 4, tri.normal[1], true);
                        view.setFloat32(offset + 8, tri.normal[2], true);
                        offset += 12;
                        
                        // Vertices
                        for (const vertex of tri.vertices) {
                            view.setFloat32(offset, vertex[0], true);
                            view.setFloat32(offset + 4, vertex[1], true);
                            view.setFloat32(offset + 8, vertex[2], true);
                            offset += 12;
                        }
                        
                        // Attribute byte count
                        view.setUint16(offset, 0, true);
                        offset += 2;
                    }
                    
                    setStlData(buffer);
                    setModelInfo({
                        description: modelData.description || `Generated ${triangleCount} triangles`,
                        printability: modelData.printability_notes || 'Standard print settings should work',
                        triangles: triangleCount,
                        usedWebSearch: useWebSearch
                    });
                    setSearchStatus('');
                    
                } catch (err) {
                    console.error('Error:', err);
                    setError(`Failed to generate model: ${err.message}`);
                    setSearchStatus('');
                } finally {
                    setLoading(false);
                }
            };

            const downloadSTL = () => {
                if (!stlData) return;
                
                const blob = new Blob([stlData], { type: 'application/octet-stream' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${prompt.replace(/[^a-z0-9]/gi, '_').substring(0, 30)}.stl`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-purple-50 via-blue-50 to-indigo-100 p-8">
                    <div className="max-w-4xl mx-auto">
                        <div className="bg-white rounded-2xl shadow-2xl p-8">
                            <div className="flex items-center gap-3 mb-6">
                                <div className="relative">
                                    <Box className="w-10 h-10 text-indigo-600" />
                                    <Sparkles className="w-5 h-5 text-purple-500 absolute -top-1 -right-1" />
                                </div>
                                <div>
                                    <h1 className="text-3xl font-bold text-gray-800">
                                        Advanced AI STL Generator
                                    </h1>
                                    <p className="text-sm text-gray-500">Powered by Claude Sonnet 4 with Web Search</p>
                                </div>
                            </div>
                            
                            <div className="bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-lg p-4 mb-6">
                                <div className="flex items-center gap-2 mb-2">
                                    <Globe className="w-5 h-5 text-blue-600" />
                                    <span className="font-semibold text-blue-800">Web Search Enhanced</span>
                                </div>
                                <p className="text-sm text-blue-700">
                                    AI can now search the internet for real-world dimensions, proportions, and reference images to create more accurate models!
                                </p>
                            </div>

                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Describe your 3D model in detail:
                                    </label>
                                    <textarea
                                        value={prompt}
                                        onChange={(e) => setPrompt(e.target.value)}
                                        placeholder={`Examples with web search:
‚Ä¢ An Eiffel Tower replica (AI will search for real dimensions)
‚Ä¢ A Tesla Model 3 car miniature (AI will find accurate proportions)
‚Ä¢ A realistic human skull (AI will research anatomy)
‚Ä¢ A Boeing 747 airplane model (AI will look up specifications)
‚Ä¢ The Space Needle in Seattle (AI will find blueprints)
‚Ä¢ A standard chess piece - knight (AI will research tournament sizes)`}
                                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-indigo-500 focus:outline-none resize-none font-mono text-sm"
                                        rows="6"
                                        disabled={loading}
                                    />
                                </div>

                                <div className="flex items-center gap-3 bg-gray-50 p-4 rounded-lg">
                                    <input
                                        type="checkbox"
                                        id="webSearch"
                                        checked={useWebSearch}
                                        onChange={(e) => setUseWebSearch(e.target.checked)}
                                        disabled={loading}
                                        className="w-5 h-5 text-indigo-600 rounded focus:ring-2 focus:ring-indigo-500"
                                    />
                                    <label htmlFor="webSearch" className="flex-1 cursor-pointer">
                                        <div className="flex items-center gap-2">
                                            <Globe className="w-4 h-4 text-indigo-600" />
                                            <span className="font-medium text-gray-800">Enable Web Search</span>
                                        </div>
                                        <p className="text-xs text-gray-600 mt-1">
                                            Search the internet for accurate dimensions and proportions (recommended for real-world objects)
                                        </p>
                                    </label>
                                </div>

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Detail Level:
                                    </label>
                                    <div className="grid grid-cols-3 gap-3">
                                        <button
                                            onClick={() => setComplexity('low')}
                                            disabled={loading}
                                            className={`px-4 py-3 rounded-lg border-2 transition-all ${
                                                complexity === 'low'
                                                    ? 'border-indigo-500 bg-indigo-50 text-indigo-700'
                                                    : 'border-gray-200 hover:border-gray-300'
                                            }`}
                                        >
                                            <div className="font-semibold">Low</div>
                                            <div className="text-xs text-gray-600">Fast, simple</div>
                                        </button>
                                        <button
                                            onClick={() => setComplexity('medium')}
                                            disabled={loading}
                                            className={`px-4 py-3 rounded-lg border-2 transition-all ${
                                                complexity === 'medium'
                                                    ? 'border-indigo-500 bg-indigo-50 text-indigo-700'
                                                    : 'border-gray-200 hover:border-gray-300'
                                            }`}
                                        >
                                            <div className="font-semibold">Medium</div>
                                            <div className="text-xs text-gray-600">Balanced</div>
                                        </button>
                                        <button
                                            onClick={() => setComplexity('high')}
                                            disabled={loading}
                                            className={`px-4 py-3 rounded-lg border-2 transition-all ${
                                                complexity === 'high'
                                                    ? 'border-indigo-500 bg-indigo-50 text-indigo-700'
                                                    : 'border-gray-200 hover:border-gray-300'
                                            }`}
                                        >
                                            <div className="font-semibold">High</div>
                                            <div className="text-xs text-gray-600">Detailed, smooth</div>
                                        </button>
                                    </div>
                                </div>

                                {searchStatus && (
                                    <div className="bg-blue-50 border-2 border-blue-200 rounded-lg p-4">
                                        <p className="text-blue-700 font-medium flex items-center gap-2">
                                            <Loader2 className="w-4 h-4 animate-spin" />
                                            {searchStatus}
                                        </p>
                                    </div>
                                )}

                                <button
                                    onClick={generateSTL}
                                    disabled={loading || !prompt.trim()}
                                    className="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 disabled:from-gray-300 disabled:to-gray-300 disabled:cursor-not-allowed text-white font-semibold py-4 px-6 rounded-lg transition-all flex items-center justify-center gap-2 shadow-lg"
                                >
                                    {loading ? (
                                        <>
                                            <Loader2 className="w-5 h-5 animate-spin" />
                                            {useWebSearch ? 'Searching & Generating...' : 'Generating Model...'}
                                        </>
                                    ) : (
                                        <>
                                            {useWebSearch ? <Globe className="w-5 h-5" /> : <Sparkles className="w-5 h-5" />}
                                            Generate STL File
                                        </>
                                    )}
                                </button>

                                {error && (
                                    <div className="bg-red-50 border-2 border-red-200 rounded-lg p-4">
                                        <p className="text-red-700 font-medium">{error}</p>
                                        <p className="text-red-600 text-sm mt-1">Try simplifying your prompt or selecting a lower detail level.</p>
                                    </div>
                                )}

                                {stlData && modelInfo && (
                                    <div className="bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200 rounded-lg p-6 space-y-4">
                                        <div>
                                            <h3 className="text-lg font-semibold text-green-800 mb-2 flex items-center gap-2">
                                                <span>‚úì</span> Model Generated Successfully!
                                                {modelInfo.usedWebSearch && (
                                                    <span className="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full flex items-center gap-1">
                                                        <Globe className="w-3 h-3" />
                                                        Web-Enhanced
                                                    </span>
                                                )}
                                            </h3>
                                            <div className="text-green-700 text-sm space-y-2">
                                                <p className="font-medium">{modelInfo.description}</p>
                                                <div className="bg-white bg-opacity-50 rounded p-3 space-y-1 text-xs">
                                                    <p><strong>Triangles:</strong> {modelInfo.triangles.toLocaleString()}</p>
                                                    <p><strong>File size:</strong> {(stlData.byteLength / 1024).toFixed(1)} KB</p>
                                                    <p><strong>Print notes:</strong> {modelInfo.printability}</p>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <button
                                            onClick={downloadSTL}
                                            className="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors flex items-center justify-center gap-2 shadow-md"
                                        >
                                            <Download className="w-5 h-5" />
                                            Download STL File
                                        </button>
                                        
                                        <div className="text-xs text-green-600 bg-white bg-opacity-50 rounded p-3">
                                            <p className="font-semibold mb-1">Next Steps:</p>
                                            <p>1. Open in your slicer (Cura, PrusaSlicer, etc.)</p>
                                            <p>2. Check the model for any issues</p>
                                            <p>3. Add supports if needed for overhangs</p>
                                            <p>4. Slice and print!</p>
                                        </div>
                                    </div>
                                )}
                            </div>

                            <div className="mt-8 pt-6 border-t border-gray-200">
                                <h3 className="font-semibold text-gray-800 mb-3">üåê Web Search Examples (Real-world accuracy):</h3>
                                <div className="grid md:grid-cols-2 gap-3 text-sm text-gray-600">
                                    <div className="bg-gray-50 p-3 rounded-lg">
                                        <p className="font-medium text-gray-800">Landmarks:</p>
                                        <p className="text-xs">"Statue of Liberty replica, accurate proportions"</p>
                                    </div>
                                    <div className="bg-gray-50 p-3 rounded-lg">
                                        <p className="font-medium text-gray-800">Vehicles:</p>
                                        <p className="text-xs">"1967 Ford Mustang miniature car model"</p>
                                    </div>
                                    <div className="bg-gray-50 p-3 rounded-lg">
                                        <p className="font-medium text-gray-800">Animals:</p>
                                        <p className="text-xs">"African elephant figurine with accurate anatomy"</p>
                                    </div>
                                    <div className="bg-gray-50 p-3 rounded-lg">
                                        <p className="font-medium text-gray-800">Architecture:</p>
                                        <p className="text-xs">"Roman Colosseum model with historically accurate details"</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<STLGenerator />, document.getElementById('root'));
    </script>
</body>
</html>